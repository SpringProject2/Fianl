<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="m">

	<!-- ////////// 일촌 구역 시작 ////////// -->
	
	<!-- 일촌 조회 -->
	<select id="selectIlchonSearch" resultType="int" parameterType="java.util.HashMap">
		<!-- Map에 VO를 통째로 담았을때 사용방법 -->
		<!-- 키값에 .을 붙인뒤 뒤에 가져올 VO의 변수 이름을 작성하면 된다. -->
		select count(*) from ilchon where
			(ilchonIdx=#{1.ilchonIdx} and ilchonSession=#{2.ilchonSession})
			or
			(ilchonIdx=#{3.ilchonSession} and ilchonSession=#{4.ilchonIdx})
	</select>
	
	<!-- 0 : 일촌 등록 -->
	<insert id="insertIlchon" parameterType="ilchon">
		insert into ilchon values(
			#{ilchonIdx},
			#{ilchonSession},
			#{ilchonUp}
		)
	</insert>
	
	<!-- 1 : 일촌 2차 조회 -->
	<select id="selectIlchon" resultType="ilchon" parameterType="ilchon">
		select * from ilchon where ilchonIdx=#{ilchonIdx} and ilchonSession=#{ilchonSession}
	</select>
	
	<!-- 일촌 갱신 -->
	<update id="updateIlchon" parameterType="ilchon">
		update ilchon set ilchonUp=#{ilchonUp} where ilchonIdx=#{ilchonSession} and ilchonSession=#{ilchonIdx}
	</update>
	
	<!-- 2 : 일촌 해제 -->
	<delete id="deleteIlchon" parameterType="ilchon">
		delete from ilchon where ilchonIdx=#{ilchonIdx} and ilchonSession=#{ilchonSession}
	</delete>
	
	<select id="selectIlchonNum" resultType="int" parameterType="ilchon">
		select count(*) from ilchon where ilchonUp=#{ilchonUp} and ilchonIdx=#{ilchonIdx}
	</select>
	
	<update id="updateIlchonNum" parameterType="signup">
		update signup set ilchon=#{ilchon} where idx=#{idx}
	</update>
	
	<!-- <select id="selectIlchonList" resultType="ilchon" parameterType="signup">
		select * from ilchon where ilchonUp=#{ilchonUp} and ilchonIdx{ilchonIdx}
	</select> -->
	
	<!-- ////////// 일촌 구역 끝 ////////// -->
	
	<!-- ////////// 일촌평 구역 시작 ////////// -->
	
	<!-- 일촌평 전체 조회 -->
	<select id="ilchon_list" resultType="main" parameterType="int">
		select * from Ilchonpyeong where ilIdx=#{idx} order by num DESC
	</select>
	
	<!-- idx에 해당하는 일촌평 갯수 구하기 -->
	<select id="countNum" resultType="int" parameterType="int">
		select count(*) from Ilchonpyeong where ilIdx=#{ilIdx}
	</select>
	
	<!-- 새 글 추가 -->
	<insert id = "ilchon_write" parameterType="main">
		insert into Ilchonpyeong values(
			#{num},
			#{ilchonpyeongText},
			#{ilIdx},
			#{ilchonSession}
		)
	</insert>
	
	<!-- ////////// 일촌평 구역 끝 ////////// -->
	
	<!-- ////////// 검색 구역 시작 ////////// -->
	
	<!-- 이름으로 친구 검색 -->
	<select id="main_search_name" resultType="signup" parameterType="String">
		select * from signup where name like '%'||#{searchValue}||'%'
	</select>
	<!-- cyworld 가입자 - ID로 친구 검색 -->
	<select id="main_search_id" resultType="signup" parameterType="String">
		select * from signup where
			(platform='cyworld' and userID like '%'||#{searchValue}||'%') or
			(platform='naver' or platform='kakao' and email like '%'||#{searchValue}||'%')
	</select>
	<!-- ////////// 검색 구역 끝 ////////// -->
	
</mapper>












